<!DOCTYPE html>
<script src="https://www.gstatic.com/firebasejs/3.8.0/firebase.js"></script>
<div id="Time"></div>
<button id="Reset">Reset</button>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: 'AIzaSyCgPq9lDCdVTgut6rUQwm2JDYRYSfyEezY',
    authDomain: 'etc-clock-916a3.firebaseapp.com',
    databaseURL: 'https://etc-clock-916a3-default-rtdb.firebaseio.com/',
    projectId: 'etc-clock-916a3',
    storageBucket: 'etc-clock-916a3.appspot.com',
    messagingSenderId: '550414492244',
    appId: '1:550414492244:web:86dfe88c3ad0df44bf43c1',
  };

  firebase.initializeApp(config);
  var database = firebase.database();

  //Listener
  database.ref().on('value', function (snapshot) {
    const stamp = snapshot.val().startstamp;
    console.log('Got timestamp: ', stamp);
    var countDownDate = new Date(stamp + 6.048e8).getTime();

    // Update the count down every 1 second
    var x = setInterval(function () {
      // Get today's date and time
      var now = new Date().getTime();

      // Find the distance between now and the count down date
      var distance = countDownDate - now;

      // Time calculations for days, hours, minutes and seconds
      var days = Math.floor(distance / (1000 * 60 * 60 * 24));
      var hours = Math.floor(
        (distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60),
      );
      var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      var seconds = Math.floor((distance % (1000 * 60)) / 1000);

      // Display the result in the element with id="demo"
      document.getElementById('Time').innerHTML =
        days + 'd ' + hours + 'h ' + minutes + 'm ' + seconds + 's ';

      // If the count down is finished, write some text
      if (distance < 0) {
        clearInterval(x);
        document.getElementById('Time').innerHTML = 'EXPIRED';
      }
    }, 1000);
  });

  $('#Reset').on('click', function () {
    const newStamp = Date.now();
    console.log('Setting timestamp to: ', newStamp);
    database.ref().set({
      startstamp: newStamp,
    });
  });
</script>
